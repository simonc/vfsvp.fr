


<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>Une introduction en profondeur à Ember.js · VF svp</title>
    <meta name="author" content="Simon Courtois (@simonc)" />
    <meta name="description" content="" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="canonical" href="
  http://vfsvp.fr/article/une-introduction-en-profondeur-a-emberjs
" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/stylesheets/style.css" media="screen" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <link rel="alternate" href="/atom.xml" title="VF svp" type="application/atom+xml" />

    <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  </head>

  <body>
    <div class="navbar navbar-default navbar-static-top">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#menu">
        <span class="sr-only">Voir la navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">VFsvp</a>
    </div>
    <div id="menu" class="collapse navbar-collapse navbar-right">
      <ul class="main-nav nav nav-pills">
        <li><a href="/">Blog</a></li>
        <li><a href="/blog/archives">Archives</a></li>
        <li>
          <a href="/atom.xml" rel="subscribe-rss" title="Suivre via RSS">
            <i class="fa fa-rss"></i> RSS
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>


    <div class="container">
      <div class="row">
        <div class="col-sm-9">
          
<article class="article" role="article">
  <div class="row">
    <div class="col-sm-2">
      <p class="article-date">
        
          <span class="day">16/01</span>
          <span class="year">2014</span>
        
      </p>
      <p class="article-comments-count">
        <a href="#" title="Commentaires">0</a>
        <i class="fa fa-comment"></i>
      </p>
    </div>
    <div class="col-sm-10 article-body">
      <header>
        
          <h1 class="article-title">Une introduction en profondeur à Ember.js</h1>
          <div class="sharing">
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://vfsvp.fr/article/une-introduction-en-profondeur-a-emberjs" data-via="VFsvp" data-counturl="http://vfsvp.fr/article/une-introduction-en-profondeur-a-emberjs" >Tweet</a>
  <div class="g-plusone" data-size="medium" data-href="http://vfsvp.fr/article/une-introduction-en-profondeur-a-emberjs"></div>
</div>

        
      </header>

      
        <div class="article-content"><p>Source:
<a href="http://coding.smashingmagazine.com/2013/11/07/an-in-depth-introduction-to-ember-js/">An In-Depth Introduction To Ember.js de Julien Knebel pour Smashing</a></p>

<p>Maintenant que <em lang="en">Ember.js 1.0</em> est sorti, il est temps d&#8217;y jeter un coup
d&#8217;oeil. Cet article s&#8217;adresse aux débutants qui souhaitent comprendre ce
<em lang="en">framework</em>.</p>

<!-- more -->


<p>Il est fréquent d&#8217;entendre les utilisateurs dire que la courbe d&#8217;apprentissage
est raide mais qu&#8217;une fois les difficultés surmontées, <em lang="en">Ember.js</em> est
tout simplement phénoménal. Ça a été également le cas pour moi. Bien que les
<a href="http://emberjs.com/guides/">guides officiels</a> soient extrêment précis et parfaitement à jour
(vraiment !), cet article a pour but de rendre les choses encore plus aisées
pour les débutants.</p>

<p>Tout d&#8217;abord, nous allons éclaircir les principaux concepts du
<em lang="en">framework</em>. Nous verrons ensuite, étape par étape, comment construire
une application avec <em lang="en">Ember.js</em> et <em lang="en">Ember-Data</em>, la couche de
stockage de données d&#8217;<em lang="en">Ember</em>. Nous verrons ensuite comment les <code>views</code> et
les <code>components</code> aident à gérer les interactions utilisateurs.</p>

<p><img src="/images/ember/emberjs-logo.png" alt="Une introduction en profondeur à Ember.js" /><br />
La fameuse mascotte d&#8217;<em lang="en">Ember</em>, <em lang="en">Tomster</em>.
(<a href="http://emberjs.com/">Crédits</a>)</p>

<p>La <strong>démo non stylisée</strong> ci-dessous, vous aidera à suivre chaque étape de ce
tutoriel. La <strong>démo stylisée</strong> est essentiellement la même mais avec bien plus
de CSS, d&#8217;animations et de réactivité sur petits écrans.</p>

<p><a href="http://jkneb.github.io/ember-crud/unstyled">Démo non stylisée</a>
<a href="https://github.com/jkneb/ember-crud">Code source</a>
<a href="http://jkneb.github.io/ember-crud">Démo stylisée</a></p>

<h2 id="sommaire">Sommaire</h2>

<ul>
<li><a href="#principaux-concepts">Principaux concepts</a>

<ul>
<li><a href="#modeles">Modèles</a></li>
<li><a href="#le-routeur">Le Routeur</a></li>
<li><a href="#controleurs">Contrôleurs</a></li>
<li><a href="#vues">Vues</a></li>
<li><a href="#components">Components</a></li>
<li><a href="#templates">Templates</a></li>
<li><a href="#helpers">Helpers</a></li>
<li><a href="#composants-helpers-vues-au-secours">Composants ? Helpers ? Vues ? Au secours !</a></li>
</ul>
</li>
<li><a href="#creons-une-application">Créons une application</a>

<ul>
<li><a href="#schema-de-notre-application">Schéma de notre application</a></li>
<li><a href="#ce-quil-vous-faut-pour-bien-commencer">Ce qu&#8217;il vous faut pour bien commencer</a></li>
<li><a href="#organisation-de-nos-fichiers">Organisation de nos fichiers</a></li>
<li><a href="#precompiler-ou-non-les-templates">Précompiler ou non les <em lang="en">templates</em> ?</a></li>
<li><a href="#creer-notre-modele-avec-le-fixtureadapter-de-ember-data">Créer notre modèle avec le <em lang="en">FixtureAdapter</em> de <em lang="en">Ember-Data</em></a></li>
<li><a href="#instancier-le-router">Instancier le Router</a></li>
<li><a href="#le-template-de-lapplication">Le <em lang="en">template</em> de l&#8217;application</a></li>
<li><a href="#la-route-users">La route <em lang="en">users</em></a></li>
<li><a href="#objectcontroller-vs-arraycontroller">ObjectController vs. ArrayController</a></li>
<li><a href="#afficher-le-nombre-dutilisateurs">Afficher le nombre d&#8217;utilisateurs</a></li>
<li><a href="#proprietes-calculees">Propriétés calculées</a></li>
<li><a href="#rediriger-depuis-la-page-index">Rediriger depuis la page Index</a></li>
<li><a href="#route-dun-utilisateur-specifique">Route d&#8217;un utilisateur spécifique</a></li>
<li><a href="#modifier-un-utilisateur">Modifier un utilisateur</a></li>
<li><a href="#notre-premiere-action">Notre première action</a></li>
<li><a href="#transitionto-ou-transitiontoroute">TransitionTo ou TransitionToRoute ?</a></li>
<li><a href="#sauvegarder-les-modifications-apportees-a-lutilisateur">Sauvegarder les modifications apportées à l&#8217;utilisateur</a></li>
<li><a href="#supprimer-un-utilisateur">Supprimer un utilisateur</a></li>
<li><a href="#creer-un-utilisateur">Créer un utilisateur</a></li>
<li><a href="#formater-les-donnees-avec-les-helpers">Formater les données avec les <em lang="en">helpers</em></a></li>
<li><a href="#formater-les-donnees-avec-un-boundhelper">Formater les données avec un <em lang="en">BoundHelper</em></a></li>
<li><a href="#passer-au-localstorage-adapter">Passer au <em lang="en">LocalStorage Adapter</em></a></li>
</ul>
</li>
<li><a href="#jouer-avec-les-vues">Jouer avec les vues</a>

<ul>
<li><a href="#jquery-et-didinsertelement">jQuery et <em lang="en">didInsertElement</em></a></li>
<li><a href="#panneaux-lateraux-avec-classname-dynamique">Panneaux latéraux avec className dynamique</a></li>
<li><a href="#modals-avec-layout-et-remontee-devenements"><em lang="en">Modals</em> avec <em lang="en">layout</em> et remontée d&#8217;événements</a></li>
</ul>
</li>
<li><a href="#quest-ce-quember-data">Qu&#8217;est-ce qu&#8217;<em lang="en">Ember-Data</em></a>

<ul>
<li><a href="#le-store">Le <em lang="en">store</em></a></li>
<li><a href="#les-adapters">Les <em lang="en">adapters</em></a></li>
<li><a href="#sans-utiliser-ember-data">Sans utiliser <em lang="en">Ember-Data</em></a></li>
</ul>
</li>
<li><a href="#quest-ce-que-la-precompilation-de-templates-handlebars">Qu&#8217;est-ce que la précompilation de <em lang="en">templates</em> <em lang="en">Handlebars</em> ?</a>

<ul>
<li><a href="#conventions-de-nommage-des-templates">Conventions de nommage des <em lang="en">templates</em></a></li>
<li><a href="#precompiler-avec-grunt">Précompiler avec <em lang="en">Grunt</em></a></li>
<li><a href="#precompiler-avec-rails">Précompiler avec <em lang="en">Rails</em></a></li>
</ul>
</li>
<li><a href="#outils-astuces-et-ressources">Outils, astuces et ressources</a>

<ul>
<li><a href="#lextension-chrome-ember">L&#8217;Extension Chrome <em lang="en">Ember</em></a></li>
<li><a href="#ember-app-kit"><em lang="en">Ember App Kit</em></a></li>
<li><a href="#ember-tools"><em lang="en">Ember Tools</em></a></li>
<li><a href="#developpement-et-version-minifie">Développement et version minifié</a></li>
<li><a href="#astuces-pour-le-debug">Astuces pour le <em lang="en">debug</em></a></li>
<li><a href="#commenter-correctement-dans-handlebars">Commenter correctement dans <em lang="en">Handlebars</em></a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a>

<ul>
<li><a href="#ressources">Ressources</a></li>
<li><a href="#remerciements">Remerciements</a></li>
</ul>
</li>
</ul>


<h2 id="principaux-concepts">Principaux concepts</h2>

<p>Le schéma ci-dessous montre comment les routes, les contrôleurs, les vues, les
<em lang="en">templates</em> et les modèles interagissent les uns avec les autres.</p>

<p><img src="/images/ember/ember-sketch.png" alt="ember-sketch" /></p>

<p>Voici une description de chacun des concepts. Pour en apprendre plus,
référez-vous à la section correspondante dans les guides officiels :</p>

<ul>
<li><a href="http://emberjs.com/guides/models">Modèles</a></li>
<li><a href="http://emberjs.com/guides/routing">Le Routeur</a></li>
<li><a href="http://emberjs.com/guides/controllers">Contrôleurs</a></li>
<li><a href="http://emberjs.com/guides/views">Vues</a></li>
<li><a href="http://emberjs.com/guides/components/">Composants</a></li>
<li><a href="http://emberjs.com/guides/templates/handlebars-basics">Templates</a></li>
<li><a href="http://emberjs.com/guides/templates/writing-helpers">Helpers</a></li>
</ul>


<h3 id="modeles">Modèles</h3>

<p>Mettons que notre application gère une liste d&#8217;utilisateurs. Ces utilisateurs
et leurs informations seraient le modèle. Vous pouvez voir cela comme les
données stockées en base de données. Les modèles peuvent être récupérés et mis à
jour en implémentant des <em lang="en">callbacks</em> AJAX dans vos routes ou vous pouvez
utiliser <em lang="en">Ember-Data</em> (une couche d&#8217;abstraction de stockage de donnés)
pour simplifier la récupération, la mise à jour et la persistence des modèles
au travers d&#8217;une API REST.</p>

<h3 id="le-routeur">Le Routeur</h3>

<p>Il y a le <code>Router</code> et, ensuite, les routes. Le <code>Router</code> est juste un synopsis de
toutes vos routes. Les routes sont la version URL des objects de votre
application (par exemple, une route <code>posts</code> correspond à un <em lang="en">listing</em>
d&#8217;utilisateurs). Le but des routes est d&#8217;appeler le modèle, via leur
<em lang="en">hook</em> <code>model</code>, pour qu&#8217;il soit accessible dans les contrôleurs et
<em lang="en">templates</em>. Les routes peuvent également servir à valuer les propriétés
d&#8217;un contrôleur, à exécuter des événements ou des actions, ou encore connecter
un <em lang="en">template</em> à un contrôleur spécifique. De plus, le <em lang="en">hook</em>
<code>model</code> peut retourner une <em lang="en">promise</em> ce qui permet d&#8217;implémenter une
<code>LoadingRoute</code> qui attend que le modèle soit récupéré de façon asynchrone.</p>

<h3 id="controleurs">Contrôleurs</h3>

<p>Un <code>controller</code> commence par récupérer le modèle d&#8217;une <code>route</code>. Il fait ensuite
le pont entre le modèle et la vue ou le <em lang="en">template</em>. Mettons que vous ayez
besoin d&#8217;une fonction pour alterner entre le mode édition et le mode normal. Des
méthodes comme <code>goIntoEditMode()</code> et <code>closeEditMode()</code> seraient parfaites et
c&#8217;est exactement ce à quoi servent les contrôleurs.</p>

<p><em lang="en">Ember.js</em> génère automatiquement les contrôleurs si vous ne les
déclarez pas. Vous pouvez par exemple créer un <em lang="en">template</em> <code>user</code> et
une <code>UserRoute</code> sans créer de <code>UserController</code> (parce que vous n&#8217;en avez pas
besoin), <em lang="en">Ember.js</em> le créera pour vous en interne (en mémoire).
L&#8217;extension Chrome appelée <a href="https://chrome.google.com/webstore/detail/ember-inspector/bmdblncegkenkacieihfhpjfppoconhi">Ember Inspector</a> peut vous aider à
trouver ces contrôleurs magiques.</p>

<h3 id="vues">Vues</h3>

<p>Les vues représentent les différentes parties de votre application (les parties
visibles par l&#8217;utilisateur dans le navigateur). Une <code>View</code> est associée à un
<code>Controller</code>, un <code>template</code> <em lang="en">Handlebars</em> et une <code>Route</code>. La différence
entre vue et <em lang="en">template</em> est particulière. Vous utiliserez une vue lorsque
vous voudrez gérer des événements ou des interactions utilisateurs qui ne
peuvent pas être pris en charge par un simple <em lang="en">template</em>. Elle ont un
<em lang="en">hook</em> bien pratique appelé <code>didInsertElement</code> au travers duquel vous
pouvez appeler jQuery très facilement et sont également très utiles pour créer
des vues réutilisables comme une <em lang="en">modal</em>, une <em lang="en">popover</em>, un
<em lang="en">date-picker</em> ou encore un champ auto-complété.</p>

<h3 id="components">Components</h3>

<p>Un <code>Component</code> est une <code>View</code> complètement isolée, qui n&#8217;a pas accès au context
dans lequel il est appelé. C&#8217;est un excellent moyen de créer un composant
réutilisable pour votre application. Ce <a href="http://jsbin.com/OMOgUzo/1/edit?html,js,output">Button Twitter</a>, ce
<a href="http://pixelhandler.com/blog/2013/08/25/create-a-custom-select-box-using-ember-component/">select personnalisé</a> ou encore ces
<a href="http://jsbin.com/odosoy/132/edit?html,js,output">graphiques réutilisables</a>
sont de très bons exemples de composants. Ce sont en fait de si bonnes idées que
le W3C travaille actuellement avec l&#8217;équipe <em lang="en">Ember</em> sur la
<a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/custom/index.html">spécification d&#8217;éléments personnalisés</a>.</p>

<h3 id="templates">Templates</h3>

<p>Pour faire simple, un <em lang="en">template</em> est la partie HTML d&#8217;une vue. Il permet
d&#8217;afficher les données du modèle et se met automatiquement à jour lorsque ce
dernier change. <em lang="en">Ember.js</em> utilise <a href="http://handlebarsjs.com">Handlebars</a>, un mécanisme
léger de <em lang="en">templating</em> également maintenu par l&#8217;équipe <em lang="en">Ember</em>. Il
fournit les outils logiques habituels comme <code>if</code> et <code>else</code>, les boucles et les
<code>helpers</code> de formatage, ce genre de choses. Les <em lang="en">templates</em> peuvent être
précompilés (si vous souhaitez les organiser en fichiers <code>.hbs</code> ou <code>.handlebars</code>
séparés) ou tout simplement écrits dans une balise
<code>&lt;script type="text/x-handlebars"&gt;&lt;/script&gt;</code> dans votre page HTML. Pour en
savoir plus sur le sujet, vous pouvez vous reporter à la section
<a href="#precompiler-ou-non-les-templates">Précompiler ou non les <em lang="en">templates</em></a>.</p>

<h3 id="helpers">Helpers</h3>

<p>Les <em lang="en">helpers</em> <em lang="en">Handlebars</em> sont des fonctions qui modifient les
données avant leur affichage (par exemple, pour donner un meilleur format que
<code>Mon Jul 29 2013 13:37:39 GMT+0200 (CEST)</code> à une date). Si votre date est écrite
sous la forme <code>{{date}}</code> dans votre <em lang="en">template</em> et que vous avez un
<em lang="en">helper</em> <code>formatDate</code> (qui converti une date en quelque chose de plus
élégant, comme &ldquo;Il y a un mois&rdquo; ou &ldquo;29 juillet 2013&rdquo;), vous pouvez vous en
servir en utilisant <code>{{formatDate date}}</code>.</p>

<h3 id="composants-helpers-vues-au-secours">Composants ? Helpers ? Vues ? Au secours !</h3>

<p>Le forum <em lang="en">Ember.js</em> a <a href="http://discuss.emberjs.com/t/whats-the-difference-between-ember-helpers-components-and-views/2201/2">une réponse</a>, tout comme
<a href="http://stackoverflow.com/questions/18593424/views-vs-components-in-ember-js">StackOverflow</a>, qui peuvent vous éviter les maux de crâne.</p>

<h2 id="creons-une-application">Créons une application</h2>

<p>Dans cette section, nous allons créer une véritable application, une simple
interface de gestion d&#8217;utilisateurs (une application de
<a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a>). Voici ce
que nous allons faire :</p>

<ul>
<li>un tour de l&#8217;architecture que nous souhaitons mettre en place ;</li>
<li>voir les dépendances, la structure de fichiers, etc ;</li>
<li>mettre en place le modèle avec le <code>FixtureAdapter</code> d&#8217;<em lang="en">Ember-Data</em> ;</li>
<li>voir comment les routes, contrôleurs, vues et <em lang="en">templates</em> interagissent ;</li>
<li>et enfin, remplacer <code>FixtureAdapter</code> par <code>LSAdapter</code> pour stocker les données
dans le <em lang="en">local storage</em> du navigateur.</li>
</ul>


<h3 id="schema-de-notre-application">Schéma de notre application</h3>

<p>Nous avons besoin d&#8217;une vue assez simple qui affiche un groupe d&#8217;utilisateurs
(voir 1 ci-dessous). Il nous faut également une vue pour voir les informations
d&#8217;un utilisateur spécifique (2). Nous devons être capables de modifier et
supprimer ces informations (3). Nous devons enfin être à même de créer un nouvel
utilisateur, pour ce faire nous réutiliserons le formulaire de modification.</p>

<p><img src="/images/ember/app-sketch.png" alt="app-sketch" /></p>

<p><em lang="en">Ember.js</em> utilise beaucoup les conventions de nommage. Si vous voulez
avoir la page <code>/foo</code> dans votre application, vous aurez ce qui suit :</p>

<ul>
<li>un <em lang="en">template</em> <code>foo</code> ;</li>
<li>une route <code>FooRoute</code> ;</li>
<li>un contrôleur <code>FooController</code> ;</li>
<li>une vue <code>FooView</code>.</li>
</ul>


<p>Pour en savoir plus, référez-vous à la section
<a href="http://emberjs.com/guides/concepts/naming-conventions">Naming conventions</a>
dans les guides.</p>

<h3 id="ce-quil-vous-faut-pour-bien-commencer">Ce qu&#8217;il vous faut pour bien commencer</h3>

<p>Vous aurez besoin de :</p>

<ul>
<li>jQuery ;</li>
<li><em lang="en">Ember.js</em>, bien sûr ;</li>
<li><em lang="en">Handlebars</em> le moteur de <em lang="en">template</em> d&#8217;<em lang="en">Ember</em> ;</li>
<li><em lang="en">Ember-Data</em>, la couche d&#8217;abstraction de stockage d&#8217;<em lang="en">Ember</em>.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /index.html
</span><span class='line'>*/
</span><span class='line'> …
</span><span class='line'> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//code.jquery.com/jquery-2.0.3.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//builds.emberjs.com/handlebars-1.0.0.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//builds.emberjs.com/tags/v1.1.2/ember.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'> <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//builds.emberjs.com/tags/v1.0.0-beta.3/ember-data.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'> <span class="nt">&lt;script&gt;</span>
</span><span class='line'>   <span class="c1">// votre code</span>
</span><span class='line'> <span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></div></figure>


<p>Le site d&#8217;<em lang="en">Ember</em> a un section <a href="http://emberjs.com/builds">Builds</a> dans laquelle vous
pouvez trouver tous les liens vers <em lang="en">Ember.js</em> et <em lang="en">Ember-Data</em>. Pour
le moment, <em lang="en">Handlebars</em> n&#8217;est pas présent sur la page, vous le trouverez
sur le <a href="http://handlebarsjs.com">site officiel de Handlebars</a>.</p>

<p>Une fois les dépendances récupérées, nous pouvons commencer à créer notre
application. Nous allons tout d&#8217;abord créer un fichier nommé <code>app.js</code> dans
lequel nous allons initialiser <em lang="en">Ember</em> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /app.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">App</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
</span></code></pre></div></figure>


<p>Juste pour vérifier que tout fonctionne, vous devriez voir les <em lang="en">logs</em> de
<em lang="en">debug</em> dans la console du navigateur.</p>

<p><img src="/images/ember/console-log-1.png" alt="console-log-1" /></p>

<h3 id="organisation-de-nos-fichiers">Organisation de nos fichiers</h3>

<p>Il n&#8217;y a pas vraiment de convention en ce qui concerne l&#8217;organisation des
fichiers et dossiers.
L&#8217;<a href="https://github.com/stefanpenner/ember-app-kit">App Kit Ember</a> (un
environnement de démarrage d&#8217;application <em lang="en">Ember</em> basé sur <em lang="en">Grunt</em>)
propose une sorte de standard puisqu&#8217;il est maintenu par l&#8217;équipe <em lang="en">Ember</em>.
Pour faire encore plus simple, vous pourriez tout mettre dans le fichier
<code>app.js</code>. C&#8217;est à vous de voir.</p>

<p>Pour ce tutoriel, nous mettrons les contrôleurs dans un dossier <code>controllers</code>,
nos vues dans un dossier <code>views</code> et ainsi de suite.</p>

<pre><code>components/
controllers/
helpers/
models/
routes/
templates/
views/
app.js
router.js
store.js
</code></pre>

<h3 id="precompiler-ou-non-les-templates">Précompiler ou non les <em lang="en">templates</em> ?</h3>

<p>Il y a deux façons de déclarer les <em lang="en">templates</em>. La plus simple est
d&#8217;ajouter une balise <code>script</code> spéciale dans votre fichier <code>index.html</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/x-handlebars&quot;</span> <span class="na">id=</span><span class="s">&quot;templatename&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Je</span> <span class="nx">suis</span> <span class="nx">un</span> <span class="nx">template</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span></code></pre></div></figure>


<p>Pour chaque <em lang="en">template</em>, il vous faut une balise <code>script</code>. C&#8217;est simple et
rapide mais ça peut très vite devenir un gros désordre si vous avez beaucoup de
<em lang="en">templates</em>.</p>

<p>L&#8217;alternative est de créer un fichier <code>.hbs</code> (ou <code>.handlebars</code>) pour chaque
<em lang="en">template</em>. C&#8217;est ce qu&#8217;on appelle la &ldquo;précompilation de <em lang="en">templates</em>&rdquo;
et une
<a href="#quest-ce-que-la-precompilation-de-templates-handlebars">section entière</a> de
cet article y est dédiée.</p>

<p>Notre <a href="http://jkneb.github.io/ember-crud/unstyled">démo non stylisée</a> utilise
des balises <code>&lt;script type="text/x-handlebars"&gt;</code> et tous les <em lang="en">templates</em> de
notre <a href="http://jkneb.github.io/ember-crud">démo améliorée</a> sont stockés dans des fichiers <code>.hbs</code> qui
sont précompilés par une tâche <a href="http://gruntjs.com">Grunt</a>. Vous pouvez ainsi
comparer les deux techniques.</p>

<h3 id="creer-notre-modele-avec-le-fixtureadapter-de-ember-data">Créer notre modèle avec le <em lang="en">FixtureAdapter</em> de <em lang="en">Ember-Data</em></h3>

<p><em lang="en">Ember-Data</em> est une bibliothèque qui permet de récupérer les données
stockées sur le serveur, de les retenir dans un <code>Store</code>, de les mettre à jour
dans le navigateur et enfin des les renvoyer au serveur pour sauvegarde. Le
<code>Store</code> peut être configuré avec différents <em lang="en">adapters</em> (par exemple, le
<code>RESTAdapter</code> qui interagit avec une API JSON ou le <code>LSAdapter</code> qui stocke les
données dans le <em lang="en">local storage</em> du navigateur).
Une <a href="#quest-ce-quember-data">section entière</a> de cet article est dédiée à
<em lang="en">Ember-Data</em>.</p>

<p>Nous allons utiliser <code>FixtureAdapter</code>. Nous commençons donc par l&#8217;instancier :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /store.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">ApplicationAdapter</span> <span class="o">=</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">FixtureAdapter</span><span class="p">;</span>
</span></code></pre></div></figure>


<p>Dans les versions précédentes d&#8217;<em lang="en">Ember</em>, il fallait hériter de <code>DS.Store</code>.
Ce n&#8217;est plus nécessaire pour instancier les <em lang="en">adapters</em>.</p>

<p><code>FixtureAdapter</code> est un très bon moyen de démarrer avec <em lang="en">Ember.js</em> et
<em lang="en">Ember-Data</em>. Il vous permet de travailler avec des données en
développement. Nous passerons au
<a href="https://github.com/rpflorence/ember-localstorage-adapter">LocalStorage adapter</a>
(ou <code>LSAdapter</code>) en fin de parcours.</p>

<p>Commençons par définir notre modèle. Un utilisateur aura un nom <code>name</code>, une
adresse <code>email</code>, une courte <code>bio</code>, un avatar <code>avatarUrl</code> et une date de création
<code>creationDate</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /models/user.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">User</span> <span class="o">=</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">name</span>         <span class="o">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
</span><span class='line'>  <span class="nx">email</span>        <span class="o">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
</span><span class='line'>  <span class="nx">bio</span>          <span class="o">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
</span><span class='line'>  <span class="nx">avatarUrl</span>    <span class="o">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
</span><span class='line'>  <span class="nx">creationDate</span> <span class="o">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">attr</span><span class="p">()</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Ajoutons ensuite quelques données d&#8217;exemple dans notre <code>Store</code>. Vous pouvez
ajouter autant d&#8217;utilisateurs que vous le souhaitez :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /models/user.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">FIXTURES</span> <span class="o">=</span> <span class="p">[{</span>
</span><span class='line'>  <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Sponge Bob&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;bob@sponge.com&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">bio</span><span class="o">:</span> <span class="s1">&#39;Lorem ispum dolor sit amet in voluptate fugiat nulla pariatur.&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">avatarUrl</span><span class="o">:</span> <span class="s1">&#39;http://jkneb.github.io/ember-crud/assets/images/avatars/sb.jpg&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">creationDate</span><span class="o">:</span> <span class="s1">&#39;Mon, 26 Aug 2013 20:23:43 GMT&#39;</span>
</span><span class='line'><span class="p">},</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;John David&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;john@david.com&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">bio</span><span class="o">:</span> <span class="s1">&#39;Lorem ispum dolor sit amet in voluptate fugiat nulla pariatur.&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">avatarUrl</span><span class="o">:</span> <span class="s1">&#39;http://jkneb.github.io/ember-crud/assets/images/avatars/jk.jpg&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">creationDate</span><span class="o">:</span> <span class="s1">&#39;Fri, 07 Aug 2013 10:10:10 GMT&#39;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="err">…</span>
</span><span class='line'><span class="p">];</span>
</span></code></pre></div></figure>


<p>Pour en savoir plus sur les modèles, consultez
<a href="http://emberjs.com/guides/models">la documentation</a>.</p>

<h3 id="instancier-le-router">Instancier le Router</h3>

<p>Définissons notre <code>Router</code> avec les routes dont nous avons besoin (basées sur le
<a href="#schema-de-notre-application">diagramme vu précédemment</a>).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /router.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">path</span><span class="o">:</span><span class="s1">&#39;/:user_id&#39;</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Le <code>Router</code> va générer les routes suivantes :</p>

<table>
<thead>
<tr>
<th>URL                  </th>
<th> Route Name   </th>
<th> Controller            </th>
<th> Route            </th>
<th> Template</th>
</tr>
</thead>
<tbody>
<tr>
<td>N/A                  </td>
<td> N/A          </td>
<td> ApplicationController </td>
<td> ApplicationRoute </td>
<td> application</td>
</tr>
<tr>
<td>/                    </td>
<td> index        </td>
<td> IndexController       </td>
<td> IndexRoute       </td>
<td> index</td>
</tr>
<tr>
<td>N/A                  </td>
<td> users        </td>
<td> UsersController       </td>
<td> UsersRoute       </td>
<td> users</td>
</tr>
<tr>
<td>/users               </td>
<td> users.index  </td>
<td> UsersIndexController  </td>
<td> UsersIndexRoute  </td>
<td> users/index</td>
</tr>
<tr>
<td>N/A                  </td>
<td> user         </td>
<td> UserController        </td>
<td> UserRoute        </td>
<td> user</td>
</tr>
<tr>
<td>/users/:user_id      </td>
<td> user.index   </td>
<td> UserIndexController   </td>
<td> UserIndexRoute   </td>
<td> user/index</td>
</tr>
<tr>
<td>/users/:user_id/edit </td>
<td> user.edit    </td>
<td> UserEditController    </td>
<td> UserEditRoute    </td>
<td> user/edit</td>
</tr>
<tr>
<td>/users/create        </td>
<td> users.create </td>
<td> UsersCreateController </td>
<td> UsersCreateRoute </td>
<td> users/create</td>
</tr>
</tbody>
</table>


<p>La partie <code>:user_id</code> est appelée segment dynamique. L&#8217;<em lang="en">ID</em> de l&#8217;utilisateur
sera injecté dans l&#8217;URL à cet emplacement. Cela aura donc la forme
<code>/users/3/edit</code>, <code>3</code> représentant l&#8217;utilisateur d&#8217;<em lang="en">ID</em> 3.</p>

<p>Vous pouvez définir soit une <code>route</code>, soit une <code>resource</code>. Une <code>resource</code> est un
groupe de routes et permet d&#8217;imbriquer d&#8217;autres routes.</p>

<p>Une <code>resource</code> réinitialise également la convention de nommage de la ressource
précédente. Cela signifie qu&#8217;au lieu d&#8217;avoir <code>UsersUserEditRoute</code>, nous aurons
<code>UserEditRoute</code>. En d&#8217;autres termes, si vous avez une ressource imbriquée dans
une autre ressource, les noms de nos fichiers seraient :</p>

<ul>
<li><code>UserEditRoute</code> au lieu de <code>UsersUserEditRoute</code> ;</li>
<li><code>UserEditControler</code> au lieu de <code>UsersUserEditController</code> ;</li>
<li><code>UserEditView</code> au lieu de <code>UsersUserEditView</code> ;</li>
<li>pour les <em lang="en">templates</em>, <code>user/edit</code> au lieu de <code>users/user/edit</code>.</li>
</ul>


<p>Vous pouvez en <a href="http://emberjs.com/guides/routing/defining-your-routes">apprendre plus sur les routes</a> dans les guides.</p>

<h3 id="le-template-de-lapplication">Le <em lang="en">template</em> de l&#8217;application</h3>

<p>Chaque application <em lang="en">Ember.js</em> nécéssite un <em lang="en">template</em> <code>Application</code>
contenant une balise <code>{{outlet}}</code> qui permet de contenir tous les autres
<em lang="en">templates</em>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/application.hbs
</span><span class='line'>*/
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h1&gt;</span>Hello World<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>  {{outlet}}
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></div></figure>


<p>Si vous suivez ce tutorial sans précompiler vos <em lang="en">templates</em>, voici ce à
quoi devrait ressembler votre <code>index.html</code> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /index.html
</span><span class='line'>*/
</span><span class='line'>  …
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/x-handlebars&quot;</span> <span class="na">id=</span><span class="s">&quot;application&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="nx">World</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span class='line'>      <span class="p">{{</span><span class="nx">outlet</span><span class="p">}}</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;dependencies.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;your-app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></div></figure>


<h3 id="la-route-users">La route <em lang="en">users</em></h3>

<p>Cette route est liée à notre liste d&#8217;utilisateurs. Comme nous l&#8217;avons vu
<a href="#le-routeur">précédemment</a> dans les définitions, une route est chargée
d&#8217;appeler le modèle. Les routes ont un <em lang="en">hook</em> <code>model</code> au travers duquel
nous pouvons effectuer une requête AJAX (pour récupérer les données lorsque
l&#8217;on n&#8217;utilise pas <em lang="en">Ember-Data</em>) ou faire appel au <code>Store</code> (si l&#8217;on utilise
<em lang="en">Ember-Data</em>). Si vous souhaitez savoir comment récupérer les données sans
<em lang="en">Ember-Data</em>, vous pouvez consulter la <a href="#sans-utiliser-ember-data">section</a>
dans laquelle j&#8217;explique brièvement comment le faire.</p>

<p>Créons maintenant notre <code>UsersRoute</code> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /routes/usersRoute.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UsersRoute</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">model</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Vous pouvez en savoir plus sur
<a href="http://emberjs.com/guides/routing/specifying-a-routes-model">comment utiliser le <em lang="en">hook</em> <code>model</code> des routes</a> dans les
guides.</p>

<p>Si vous visitez votre application à l&#8217;URL <code>http://localhost/#/users</code>, rien ne se
produit, nous avons d&#8217;abord besoin du <em lang="en">template</em> <code>users</code>. Le voici :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/users.hbs
</span><span class='line'>*/
</span><span class='line'><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;users-listing&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  {{#each user in controller}}
</span><span class='line'>    <span class="nt">&lt;li&gt;</span>{{user.name}}<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  {{else}}
</span><span class='line'>    <span class="nt">&lt;li&gt;</span>pas d&#39;utilisateurs… :-(<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  {{/each}}
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span></code></pre></div></figure>


<p>La boucle <code>each</code> parcourt la collection d&#8217;utilisateurs, <code>controller</code> vaut ici
<code>UsersController</code>. Notez que la boucle <code>{{#each}}</code> contient un <code>{{else}}</code> de
façon à ce que, lorsque le modèle est vide, <code>pas d'utilisateurs… :-(</code> soit
affiché.</p>

<p>Comme nous suivons la convention de nommage d&#8217;<em lang="en">Ember</em>, nous pouvons nous
passer de déclarer <code>UsersController</code>. <em lang="en">Ember</em> devine que l&#8217;on gère une
collection car nous avons utilisé la forme plurielle de &ldquo;user&rdquo;.</p>

<h3 id="objectcontroller-vs-arraycontroller">ObjectController vs. ArrayController</h3>

<p>Un <code>ObjectController</code> est lié à un seul objet et un <code>ArrayController</code> est lié à
un groupe d&#8217;objets (comme une collection). Comme nous venons de le voir, nous
n&#8217;avons pas besoin de déclarer de <code>ArrayController</code>. Juste pour cet article,
nous allons cependant le déclarer pour lui attribuer quelques propriétés :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /controllers/usersController.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UsersController</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ArrayController</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">sortProperties</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span class='line'>  <span class="nx">sortAscending</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// false = descending</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Nous avons simplement trié nos utilisateurs par ordre alphabétique. Consultez
les guides pour en <a href="http://emberjs.com/guides/controllers">apprendre plus sur les contrôleurs</a>.</p>

<h3 id="afficher-le-nombre-dutilisateurs">Afficher le nombre d&#8217;utilisateurs</h3>

<p>Utilisons <code>UsersController</code> pour créer notre première propriété calculée
(<a href="http://emberjs.com/guides/object-model/computed-properties/">computed property</a>). Celle-ci affichera le nombre
d&#8217;utilisateurs pour que nous puissions voir un changement lors de l&#8217;ajout ou de
la suppression d&#8217;un utilisateur.</p>

<p>Dans le <em lang="en">template</em>, il nous suffit d&#8217;utiliser ceci :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/users.hbs
</span><span class='line'>*/
</span><span class='line'>…
</span><span class='line'><span class="nt">&lt;div&gt;</span>Utilisateurs: {{usersCount}}<span class="nt">&lt;/div&gt;</span>
</span><span class='line'>…
</span></code></pre></div></figure>


<p>Déclarons ensuite la propriété <code>usersCount</code> dans <code>UsersController</code> à la
différence que ce n&#8217;est pas une propriété classique puisqu&#8217;elle dépend de la
longueur du modèle.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /controllers/usersController.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UsersController</span> <span class="o">=</span> <span class="nx">Em</span><span class="p">.</span><span class="nx">ArrayController</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="err">…</span>
</span><span class='line'>  <span class="nx">usersCount</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;model.length&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}.</span><span class="nx">property</span><span class="p">(</span><span class="s1">&#39;@each&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Pour faire simple, <code>usersCount</code> utilise la méthode <code>.property('@each')</code> qui
indique à <em lang="en">Ember.js</em> que cette fonction est une propriété qui observe tout
changement sur l&#8217;un des modèles de la collection (ici les utilisateurs). Nous
verrons ensuite <code>usersCount</code> s&#8217;incrémenter ou se décrémenter chaque fois que
nous ajouterons ou supprimerons un utilisateur.</p>

<h3 id="proprietes-calculees">Propriétés calculées</h3>

<p>Les propriétés calculées sont puissantes. Elles permettent de déclarer des
fonctions en tant que propriétés. Voyons comment elles fonctionnent.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">Person</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">firstName</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">lastName</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">fullName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;firstName&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;lastName&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}.</span><span class="nx">property</span><span class="p">(</span><span class="s1">&#39;firstName&#39;</span><span class="p">,</span> <span class="s1">&#39;lastName&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">ironMan</span> <span class="o">=</span> <span class="nx">App</span><span class="p">.</span><span class="nx">Person</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">firstName</span><span class="o">:</span> <span class="s2">&quot;Tony&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">lastName</span><span class="o">:</span>  <span class="s2">&quot;Stark&quot;</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">ironMan</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;fullName&#39;</span><span class="p">)</span> <span class="c1">// &quot;Tony Stark&quot;</span>
</span></code></pre></div></figure>


<p>Dans l&#8217;exemple ci-dessus, l&#8217;objet <code>Person</code> a deux propriétés statiques,
<code>firsName</code> et <code>lastName</code>. Il a également une propriétés calculées <code>fullName</code> qui
concatène le prénom et le nom pour créer un nom complet. Notez que l&#8217;appel à
<code>.property('firsName', 'lastName')</code> indique que la fonction est de nouveau
exécutée lorsque <code>firsName</code> ou <code>lastName</code> change.</p>

<p>Les propriétés (statiques ou calculées) sont récupérables grâce à la méthode
<code>.get('property')</code> et peuvent être assignées via <code>.set('property', newValue)</code>.</p>

<p>Si vous avez besoin d&#8217;assigner plusieurs propriétés, il y a mieux que de le
faire une par une. Vous pouvez utiliser <code>.setProperties({})</code> plutôt que
plusieurs appels à <code>.set()</code>. Au lieu de ceci :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;propertyA&#39;</span><span class="p">,</span> <span class="s1">&#39;valueA&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;propertyB&#39;</span><span class="p">,</span> <span class="nx">valueB</span><span class="p">);</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;propertyC&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;propertyD&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Utilisez</span> <span class="nx">plut</span><span class="err">ô</span><span class="nx">t</span> <span class="nx">cela</span><span class="err"> </span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">setProperties</span><span class="p">({</span>
</span><span class='line'>  <span class="s1">&#39;propertyA&#39;</span><span class="o">:</span> <span class="s1">&#39;valueA&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;propertyB&#39;</span><span class="o">:</span> <span class="nx">valueB</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;propertyC&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;propertyD&#39;</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>La documentation contient beaucoup d&#8217;informations sur comment lier les données
grâce aux <a href="http://emberjs.com/guides/object-model/computed-properties/">propriétés calculées</a>, aux
<a href="http://emberjs.com/guides/object-model/observers">observers</a> et aux
<a href="http://emberjs.com/guides/object-model/bindings">bindings</a>.</p>

<h3 id="rediriger-depuis-la-page-index">Rediriger depuis la page Index</h3>

<p>Si vous visitez la page d&#8217;accueil de votre application (<code>http://localhost/</code>),
rien ne se passe. Cela est dû au fait que nous consultons la page <code>index</code> et que
nous n&#8217;avons pas de <em lang="en">template</em> <code>index</code>, nous allons donc en ajouter un que
nous appellerons <code>index.hbs</code>.</p>

<p><em lang="en">Ember.js</em> sait que vous créez un <em lang="en">template</em> <code>index</code> pour la route
<code>IndexRoute</code>, vous n&#8217;avez donc rien à indiquer dans le <code>Router</code> pour que
tout fonctionne. C&#8217;est ce que l&#8217;on appelle une route initiale. Il en existe
trois : <code>ApplicationRoute</code>, <code>IndexRoute</code> et <code>LoadingRoute</code>. Consultez
<a href="http://emberjs.com/guides/routing/defining-your-routes/#toc_initial-routes">les guides</a> pour en savoir plus.</p>

<p>Ajoutons un lien vers la page des utilisateurs avec le <em lang="en">block helper</em>
<code>{{#link-to}}…{{/link-to}}</code>. Pourquoi un <em lang="en">block helper</em> ? Parce que vous
pouvez écrire du texte entre les balises comme s&#8217;il s&#8217;agissait de balises HTML.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/index.hbs
</span><span class='line'>*/
</span><span class='line'>{{#link-to &quot;users&quot;}} Go to the users page {{/link-to}}
</span></code></pre></div></figure>


<p>Le premier argument est le nom de la route vers laquelle pointe le lien. Le
deuxième argument, optionnel, est un modèle. Le résultat est un <code>&lt;a&gt;</code> classique
mais <em lang="en">Ember</em> gère automatiquement la classe <code>active</code> en fonction de la
route active. <code>link-to</code> est parfait pour une menu par exemple. Vous pouvez en
apprendre plus <a href="http://emberjs.com/guides/templates/links">dans les guides</a>.</p>

<p>Une autre approche pourrait être de dire à <code>IndexRoute</code> de rediriger vers
<code>UsersRoute</code>. Encore une fois, c&#8217;est assez simple :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /routes/indexRoute.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">IndexRoute</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">redirect</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">transitionTo</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Lorsque l&#8217;on visite la page d&#8217;accueil, on est immédiatement redirigé vers
<code>/#/users</code>.</p>

<h3 id="route-dun-utilisateur-specifique">Route d&#8217;un utilisateur spécifique</h3>

<p>Avant de gérer les segments dynamiques, nous devons créer un lien vers chaque
utilisateur depuis le <em lang="en">template</em> <code>users</code>. Utilisons le <em lang="en">block helper</em>
<code>{{#link-to}}</code> dans une boucle <code>each</code> qui parcourt les utilisateurs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/users.hbs
</span><span class='line'>*/
</span><span class='line'>…
</span><span class='line'>{{#each user in controller}}
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>
</span><span class='line'>    {{#link-to &quot;user&quot; user}}
</span><span class='line'>      {{user.name}}
</span><span class='line'>    {{/link-to}}
</span><span class='line'>  <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>{{/each}}
</span></code></pre></div></figure>


<p>Le deuxième argument passé à <code>link-to</code> est le modèle à passer à <code>UserRoute</code>.</p>

<p>Occupons-nous maintenant du <em lang="en">template</em> d&#8217;un utilisateur spécifique. Il
ressemble à ceci :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/user.hbs
</span><span class='line'>*/
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;user-profile&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;img</span> <span class="err">{{</span><span class="na">bind-attr</span> <span class="na">src=</span><span class="s">&quot;avatarUrl&quot;</span><span class="err">}}</span> <span class="na">alt=</span><span class="s">&quot;Avatar de l&#39;utilisateur&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h2&gt;</span>{{name}}<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span&gt;</span>{{email}}<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;</span>{{bio}}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span&gt;</span>Création {{creationDate}}<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></div></figure>


<p>Notez que vous ne pouvez pas utiliser <code>&lt;img src="{{avatarUrl}}"&gt;</code>, les données
attachées à un attribut doivent utiliser le <em lang="en">helper</em> <code>bind-attr</code>. Vous
pouvez par exemple écrire <code>&lt;img {{bind-attr height="imgHeight"}}&gt;</code> avec
<code>imgHeight</code> qui serait une propriété calculée dans le contrôleur.</p>

<p>Vous trouverez tout ce dont vous avez besoin sur les
<a href="http://emberjs.com/guides/templates/binding-element-attributes/">attributs</a> et les
<a href="http://emberjs.com/guides/templates/binding-element-class-names">classes HTML</a> dans les guides.</p>

<p>Jusque là, tout va bien mais rien ne se passe lorsque l&#8217;on clique sur le lien
d&#8217;un utilisateur. Cela est dû au fait que nous avons dit au <code>Router</code> que nous
voulions imbriquer <code>UserRoute</code> dans <code>UsersRoute</code>. Nous avons donc besoin d&#8217;un
<code>{{outlet}}</code> dans lequel afficher le <em lang="en">template</em> d&#8217;un utilisateur.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/users.hbs
</span><span class='line'>*/
</span><span class='line'>…
</span><span class='line'>{{#each user in controller}}
</span><span class='line'>…
</span><span class='line'>{{/each}}
</span><span class='line'>
</span><span class='line'>{{outlet}}
</span></code></pre></div></figure>


<p><code>{{outlet}}</code> est une sorte d&#8217;espace réservé dans lequel les autres
<em lang="en">templates</em> peuvent être injectés lorsque l&#8217;on clique sur un
<code>{{#link-to}}</code>. Cela permet d&#8217;imbriquer les vues.</p>

<p>Vous devriez maintenant voir le <em lang="en">template</em> d&#8217;un utilisateur s&#8217;afficher dans
la page lorsque vous visitez l&#8217;URL <code>/#/users/1</code>.</p>

<p>Attendez une minute ! Nous n&#8217;avons déclaré ni <code>UserRoute</code> ni <code>UserController</code> et
pourtant tout fonctionne ! Comment est-ce possible ? <code>UserRoute</code> est la version
singulière de <code>UsersRoute</code>, <em lang="en">Ember</em> génère donc la route et le contrôleur
pour nous (en mémoire). Merci aux conventions de nommage !</p>

<p>Pour une question de consistance, nous allons les déclrarer, juste pour voir à
quoi il ressemblent :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /routes/userRoute.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UserRoute</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">model</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">user_id</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* /controllers/userController.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UserController</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ObjectController</span><span class="p">.</span><span class="nx">extend</span><span class="p">();</span>
</span></code></pre></div></figure>


<p>Pour en apprendre plus sur les <a href="http://emberjs.com/guides/routing/specifying-a-routes-model/#toc_dynamic-models">segments dynamiques</a>,
rendez-vous dans les guides.</p>

<h3 id="modifier-un-utilisateur">Modifier un utilisateur</h3>

<p>Passons maintenant au formulaire de modification d&#8217;un utilisateur, imbriqué dans
la page de ce dernier. Le <em lang="en">template</em> ressemble à ceci :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/user/edit.hbs
</span><span class='line'>*/
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;user-edit&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Choisissez votre avatar<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  {{input value=avatarUrl}}
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Nom de l&#39;utilisateur<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  {{input value=name}}
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Email de l&#39;utilisateur<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  {{input value=email}}
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Bio de l&#39;utilisateur<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  {{textarea value=bio}}
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></div></figure>


<p>Arrêtons-nous une minute sur ces balises <a href="http://emberjs.com/api/classes/Ember.Handlebars.helpers.html#method_input"><code>{{input}}</code></a>. Le but de
ce formulaire est de permettre la modification des données d&#8217;un utilisateur et
ces balises <code>input</code> prennent en paramètre les propriétés du modèle pour s&#8217;y
attacher.</p>

<p>Notez bien que l&#8217;on écrit <code>value=model</code>, sans les <code>" "</code>. Le <em lang="en">helper</em>
<code>{{input}}</code> est un raccourcis pour <code>{{Ember.TextField}}</code>. <em lang="en">Ember.js</em>
propose plusieurs
<a href="http://emberjs.com/guides/views/built-in-views">vues prédéfinies</a>, en
particulier pour les éléments de formulaires.</p>

<p>Si vous visitez l&#8217;URL <code>/#/users/1/edit</code> de votre application, rien ne se passe.
Nous avons de nouveau besoin d&#8217;un <code>{{outlet}}</code> pour imbriquer le <em lang="en">template</em>
du formulaire dans celui de l&#8217;utilisateur.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/user.hbs
</span><span class='line'>*/
</span><span class='line'>…
</span><span class='line'>{{outlet}}
</span></code></pre></div></figure>


<p>Le <em lang="en">template</em> est maintenant injecté dans la page mais les champs sont
toujours vides. Nous devons dire à la route quel modèle utiliser.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /routes/userEditRoute.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UserEditRoute</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">model</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">modelFor</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>La méthode
<a href="http://emberjs.com/api/classes/Ember.Route.html#method_modelFor">modelFor</a> vous
permet d&#8217;utiliser le modèle d&#8217;une autre route. Nous avons indiqué à
<code>UserEditRoute</code> d&#8217;utiliser le modèle de <code>UserRoute</code>. Les champs sont maintenant
remplis correctement avec les données du modèle. Essayez de les modifier, vous
pourrez voir les modifications reportées en direct dans le <em lang="en">template</em>
parent !</p>

<h3 id="notre-premiere-action">Notre première action</h3>

<p>Ok, nous avons besoin d&#8217;un bouton sur lequel cliquer pour être redirigé de
<code>UserRoute</code> vers <code>UserEditRoute</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/user.hbs
</span><span class='line'>*/
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;user-profile&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;button</span> <span class="err">{{</span><span class="na">action</span> <span class="err">&quot;</span><span class="na">edit</span><span class="err">&quot;}}</span><span class="nt">&gt;</span>Modifier<span class="nt">&lt;/button&gt;</span>
</span><span class='line'>  …
</span></code></pre></div></figure>


<p>Nous venons d&#8217;ajouter un simple <code>button</code> qui lance notre première <code>{{action}}</code>.
Les actions sont des événements qui lancent les méthodes associées dans le
contrôleur courant.  Si aucune méthode n&#8217;est trouvée, l&#8217;action remonte
(<em lang="en">bubble</em>) les routes jusqu&#8217;à trouver quelque chose. Ce mécanisme est très
bien expliqué <a href="http://emberjs.com/guides/templates/actions/#toc_action-bubbling">dans les guides</a>.</p>

<p>En d&#8217;autres termes, si nous cliquons (<code>click</code>) sur le <code>button</code>, il va lancer
l&#8217;action <code>edit</code> qui se trouve dans le contrôleur. Ajoutons-la à
<code>UserController</code> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /controllers/userController.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UserController</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ObjectController</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">edit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">transitionToRoute</span><span class="p">(</span><span class="s1">&#39;user.edit&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Les actions, que ce soit dans un contrôleur ou une route, sont stockées dans
le <em lang="en">hash</em> <code>actions</code>. Ce n&#8217;est cependant pas le cas des actions par défaut
comme <code>click</code>, <code>doubleClick</code>, <code>mouseLeave</code> ou <code>dragStart</code>. Le site
d&#8217;<em lang="en">Ember.js</em> contient la
<a href="http://emberjs.com/api/classes/Ember.View.html#toc_event-names">liste complète</a>
de ces actions.</p>

<p>Notre action <code>edit</code> dit simplement &ldquo;Va sur la route <code>user.edit</code>&rdquo;. C&#8217;est à peu
près tout.</p>

<h3 id="transitionto-ou-transitiontoroute">TransitionTo ou TransitionToRoute ?</h3>

<p>Notez que la transition depuis une route est différente de la transition depuis
un contrôleur :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="c1">// depuis une route</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">transitionTo</span><span class="p">(</span><span class="s1">&#39;your.route&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c1">// depuis un contrôleur</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">transitionToRoute</span><span class="p">(</span><span class="s1">&#39;your.route&#39;</span><span class="p">)</span>
</span></code></pre></div></figure>


<h3 id="sauvegarder-les-modifications-apportees-a-lutilisateur">Sauvegarder les modifications apportées à l&#8217;utilisateur</h3>

<p>Voyons maintenant comment sauvegarder nos modifications après avoir changé la
valeur des données de l&#8217;utilisateur. Par sauvegarder, j&#8217;entends rendre
persistant. Avec <em lang="en">Ember-Data</em>, cela signifie d&#8217;appeler <code>save()</code> sur le
<code>Store</code> et de sauvegarder le nouveau <code>record</code> correspondant à l&#8217;utilisateur.
Le <code>Store</code> va ensuite dire à l&#8217;<code>adapter</code> d&#8217;effectuer une requête AJAX <em lang="en">PUT</em>
(si vous utilisez <code>RESTAdapter</code>).</p>

<p>Dans notre application, il s&#8217;agit d&#8217;un <code>button</code> &ldquo;OK&rdquo; qui sauvegarde les
modifications et retourne à la route parente. Nous allons à nouveau utiliser
une <code>{{action}}</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/user/edit.hbs
</span><span class='line'>*/
</span><span class='line'><span class="nt">&lt;button</span> <span class="err">{{</span><span class="na">action</span> <span class="err">&quot;</span><span class="na">save</span><span class="err">&quot;}}</span><span class="nt">&gt;</span> ok <span class="nt">&lt;/button&gt;</span>
</span></code></pre></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /controllers/userEditController.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UserEditController</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ObjectController</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">save</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">// cela indique à Ember-Data de sauvegarder le nouvel enregistrement</span>
</span><span class='line'>      <span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span><span class='line'>      <span class="c1">// puis transite vers l&#39;utilisateur courant</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">transitionToRoute</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Notre mode &ldquo;modification&rdquo; fonctionne bien. Passons maintenant à la suppression
d&#8217;un utilisateur.</p>

<h3 id="supprimer-un-utilisateur">Supprimer un utilisateur</h3>

<p>Nous pouvons ajouter un <code>button</code> &ldquo;Supprimer&rdquo; à côté du bouton &ldquo;Modifier&rdquo; dans le
<em lang="en">template</em> d&#8217;un utilisateur. Cette fois nous aurons une <code>{{action}}</code>
<code>delete</code> définie dans <code>UserController</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/user.hbs
</span><span class='line'>*/
</span><span class='line'><span class="nt">&lt;button</span> <span class="err">{{</span><span class="na">action</span> <span class="err">&quot;</span><span class="na">delete</span><span class="err">&quot;}}</span><span class="nt">&gt;</span>Supprimer<span class="nt">&lt;/button&gt;</span>
</span></code></pre></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /controllers/userController.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="err">…</span>
</span><span class='line'><span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">delete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="c1">// ceci indique à Ember-Data de supprimer l&#39;utilisateur courant</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">).</span><span class="nx">deleteRecord</span><span class="p">();</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">).</span><span class="nx">save</span><span class="p">();</span>
</span><span class='line'>    <span class="c1">// puis transite vers la route users</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">transitionToRoute</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></div></figure>


<p>Lorsque l&#8217;on clique sur le bouton &ldquo;Supprimer&rdquo;, l&#8217;utilisateur est directement
supprimé. Un peu direct ; un message de confirmation comme &ldquo;Êtes-vous sûr ?&rdquo;
avec des boutons &ldquo;Oui&rdquo; et &ldquo;Non&rdquo; seraient bienvenus. Pour ce faire, nous devons
modifier notre <code>{{action "delete"}}</code> pour afficher <code>confirm-box</code> plutôt que de
supprimer immédiatement l&#8217;utilisateur. Et, bien sûr, nous devons mettre
<code>confirm-box</code> dans le <em lang="en">template</em> <code>user</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/user.hbs
</span><span class='line'>*/
</span><span class='line'>{{#if deleteMode}}
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;confirm-box&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h4&gt;</span>Sûr ?<span class="nt">&lt;/h4&gt;</span>
</span><span class='line'>  <span class="nt">&lt;button</span> <span class="err">{{</span><span class="na">action</span> <span class="err">&quot;</span><span class="na">confirmDelete</span><span class="err">&quot;}}</span><span class="nt">&gt;</span> oui <span class="nt">&lt;/button&gt;</span>
</span><span class='line'>  <span class="nt">&lt;button</span> <span class="err">{{</span><span class="na">action</span> <span class="err">&quot;</span><span class="na">cancelDelete</span><span class="err">&quot;}}</span><span class="nt">&gt;</span> non <span class="nt">&lt;/button&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>{{/if}}
</span></code></pre></div></figure>


<p>Nous venons d&#8217;écrire notre premier <code>{{if}}</code> avec <em lang="en">Handlebars</em>. Il n&#8217;écrit
<code>div.confirm-box</code> que lorsque la propriété <code>deleteMode</code> est à <code>true</code>. Nous
devons définir <code>deleteMode</code> dans le contrôleur et modifier l&#8217;action <code>delete</code>
pour qu&#8217;il passe <code>deleteMode</code> à <code>true</code> ou <code>false</code>. Notre <code>UserController</code>
ressemble maintenant à ceci :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /controllers/userController.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UserController</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ObjectController</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="c1">// la propriété deleteMode est à false par défaut</span>
</span><span class='line'>  <span class="nx">deleteMode</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">delete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// notre méthode delete change uniquement la valeur de deleteMode</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">toggleProperty</span><span class="p">(</span><span class="s1">&#39;deleteMode&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">cancelDelete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// remet deleteMode à false</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;deleteMode&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">confirmDelete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// ceci indique à Ember-Data de supprimer l&#39;utilisateur courant</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">).</span><span class="nx">deleteRecord</span><span class="p">();</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">).</span><span class="nx">save</span><span class="p">();</span>
</span><span class='line'>      <span class="c1">// puis transite vers la route users</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">transitionToRoute</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">// et remet deleteMode à false</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;deleteMode&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="c1">// le méthode edit reste la même</span>
</span><span class='line'>    <span class="nx">edit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">transitionToRoute</span><span class="p">(</span><span class="s1">&#39;user.edit&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>La suppression fonctionne maintenant comme il faut avec les boutons &ldquo;Oui&rdquo; et
&ldquo;Non&rdquo;. Génial ! Il ne reste plus que la route de création à écrire.</p>

<h3 id="creer-un-utilisateur">Créer un utilisateur</h3>

<p>Pour la création de l&#8217;utilisateur, essayons quelque chose de fun : réutilisons
le <em lang="en">template</em> <code>edit</code>. Au final, le formulaire est exactement le même que
celui de modification d&#8217;un utilisateur. Commençons par déclarer la route qui va
retourner un objet vide dans son <em lang="en">hook</em> <code>model</code> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /routes/usersCreateRoute.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UsersCreateRoute</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">model</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="c1">// le modèle de cette route est un nouvel Ember.Object vide</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">Em</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">({});</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// dans le cas présent (la route create), nous pouvons réutiliser le template</span>
</span><span class='line'>  <span class="c1">// user/edit associé avec usersCreateController</span>
</span><span class='line'>  <span class="nx">renderTemplate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;user.edit&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">controller</span><span class="o">:</span> <span class="s1">&#39;usersCreate&#39;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>La méthode <code>renderTemplate</code> nous permet d&#8217;associer un <em lang="en">template</em> spécifique
à une route. Nous indiquons à <code>UsersCreateRoute</code> d&#8217;utiliser le <em lang="en">template</em>
<code>user.edit</code> avec <code>UsersCreateController</code>. Vous pouvez en apprendre plus sur
<code>renderTemplate</code>
<a href="http://emberjs.com/guides/routing/rendering-a-template/">dans les guides</a>.</p>

<p>Définissons maintenant une autre action <code>save</code>, mais dans
<code>UsersCreateController</code> cette fois (souvenez-vous qu&#8217;une <code>action</code> va d&#8217;abord
chercher une méthode correspondante dans le contrôleur <em>courant</em>).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /controllers/usersCreateController.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UsersCreateController</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ObjectController</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">actions</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">save</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// nous donnons une date de création juste avant la sauvegarde</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;creationDate&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// crée un nouvel enregistrement et le sauvegarde dans le Store</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">newUser</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">createRecord</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">));</span>
</span><span class='line'>      <span class="nx">newUser</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// redirige vers l&#39;utilisateur lui-même</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">transitionToRoute</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">newUser</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Ajoutons maintenant un <code>{{#link-to}}</code> dans le <em lang="en">template</em> <code>users</code> pour
pouvoir accéder au formulaire de création :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/users.hbs
</span><span class='line'>*/
</span><span class='line'>{{#link-to &quot;users.create&quot; class=&quot;create-btn&quot;}} Ajouter un utilisateur {{/link-to}}
</span><span class='line'>…
</span></code></pre></div></figure>


<p>C&#8217;est tout ce dont nous avons besoin pour créer des utilisateurs !</p>

<h3 id="formater-les-donnees-avec-les-helpers">Formater les données avec les <em lang="en">helpers</em></h3>

<p>Nous avons <a href="#helpers">déjà vu</a> ce que sont les <em lang="en">helpers</em>. Voyons maintenant
comment en créer un qui nous permette de formater une date toute moche en
quelque chose de plus propre. La bibliothèque <a href="http://momentjs.com">Moment.js</a> est
exactement ce dont nous avons besoin.</p>

<p>Récupérez <a href="http://momentjs.com">Moment.js</a> et chargez le dans la page. Nous allons ensuite
définir notre premier <em lang="en">helper</em> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /helpers/helpers.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">Ember</span><span class="p">.</span><span class="nx">Handlebars</span><span class="p">.</span><span class="nx">helper</span><span class="p">(</span><span class="s1">&#39;formatDate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">){</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Modifions le <em lang="en">template</em> <code>user</code> pour qu&#8217;il fasse appel au <em lang="en">helper</em>
<code>formatDate</code> sur la propriété <code>{{creationDate}}</code> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='html'><span class='line'>/* /templates/user.hbs
</span><span class='line'>*/
</span><span class='line'>…
</span><span class='line'><span class="nt">&lt;span&gt;</span>Création {{formatDate creationDate}}<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>…
</span></code></pre></div></figure>


<p>C&#8217;est tout ! Les dates devraient s&#8217;afficher sous la forme &ldquo;2 days ago&rdquo; (il y a
deux jours), &ldquo;One month ago&rdquo; (il y a un mois), etc.</p>

<p><abbr title="Note du traducteur">NDT</abbr> : Moment.js permet d&#8217;utiliser
d&#8217;autres langues que l&#8217;anglais, tout est expliqué
<a href="http://momentjs.com/docs/#/i18n/">dans la documentation</a>.</p>

<h3 id="formater-les-donnees-avec-un-boundhelper">Formater les données avec un <em lang="en">BoundHelper</em></h3>

<p>Dans le cas précédent, la date est fixe et ne risque pas de changer. Si nous
avons par contre des données qui doivent être mises à jour (par exemple un
prix formaté), il faut utiliser un <code>BoundHelper</code> au lien d&#8217;un <em lang="en">helper</em>
classique.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /helpers/helpers.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">Ember</span><span class="p">.</span><span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerBoundHelper</span><span class="p">(</span><span class="s1">&#39;formatDate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">){</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Un <code>BoundHelper</code> sait se mettre à jour automatiquement lorsque les données
changent. Vous pouvez en apprendre plus sur le sujet
<a href="http://emberjs.com/api/classes/Ember.Handlebars.html#method_registerBoundHelper">dans les guides</a>.</p>

<h3 id="passer-au-localstorage-adapter">Passer au <em lang="en">LocalStorage Adapter</em></h3>

<p>Notre application fonctionne bien, nous sommes donc prêts à passer aux choses
sérieuses. Nous pourrions utiliser le <code>RESTAdapter</code> mais nous aurions du coup
besoin d&#8217;un server REST sur lequel effectuer des requêtes <code>GET</code>, <code>PUT</code>, <code>POST</code>
et <code>DELETE</code>. Nous allons plutôt utiliser le <code>LSAdapter</code>, un <em lang="en">adapter</em>
externe que vous pouvez <a href="https://github.com/rpflorence/ember-localstorage-adapter/blob/master/localstorage_adapter.js">télécharger sur GitHub</a>. Ajoutez-le dans
votre page (juste après <em lang="en">Ember-Data</em>), commentez toutes les données
<code>FIXTURE</code> et changez <code>ApplicationAdapter</code> pour <code>DS.LSAdapter</code> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /store.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">ApplicationAdapter</span> <span class="o">=</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">LSAdapter</span><span class="p">;</span>
</span></code></pre></div></figure>


<p>Les données de vos utilisateurs seront maintenant stockées dans le
<em lang="en">local storage</em> (stockage local du navigateur). C&#8217;est tout ! Sérieusement,
c&#8217;est aussi simple que ça. Pour vous en assurer, ouvrez les
<em lang="en">Developer Tools</em> dans votre navigateur et rendez-vous dans le panneau
&ldquo;Ressource&rdquo;. Dans l&#8217;onglet &ldquo;Local Storage&rdquo; vous devriez trouver une entrée pour
<code>LSAdapter</code> avec toutes les données de vos utilisateurs.</p>

<p><img src="/images/ember/console-localstorage.png" alt="console-localstorage" /></p>

<h2 id="jouer-avec-les-vues">Jouer avec les vues</h2>

<p>Jusque là, nous n&#8217;avons déclaré aucune vue dans notre application, seulement des
<em lang="en">templates</em>. Pourquoi nous soucier des vues ? Et bien, elles sont très
puissantes pour gérer des événements, des animations ou des composants
réutilisables.</p>

<h3 id="jquery-et-didinsertelement">jQuery et <em lang="en">didInsertElement</em></h3>

<p>Que devons-nous faire pour utiliser jQuery comme d&#8217;habitude avec les vues
<em lang="en">Ember.js</em> ? Chaque vue ou composant a un <em lang="en">hook</em> <code>didInsertElement</code>
qui nous indique que la vue a effectivement été chargée dans le DOM. Cela vous
assure un accès aux éléments de la page depuis jQuery.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">MyAwesomeComponent</span> <span class="o">=</span> <span class="nx">Em</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">didInsertElement</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="c1">// this = la vue</span>
</span><span class='line'>    <span class="c1">// this.$() = $(la vue)</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">().</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;.child .elem&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// quelque chose utilisant jQuery</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Si vous avez des événements du style jQuery enregistrés dans <code>didInsertElement</code>,
vous pouvez utiliser <code>willDestroyElement</code> pour les retirer après la suppression
d&#8217;une vue dans le DOM, comme ceci :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">MyAwesomeComponent</span> <span class="o">=</span> <span class="nx">Em</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">didInsertElement</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">().</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;.child .elem&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// quelque chose utilisant jQuery</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">willDestroyElement</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">().</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<h3 id="panneaux-lateraux-avec-classname-dynamique">Panneaux latéraux avec className dynamique</h3>

<p>La combinaison des propriétés calculées et de classes (<code>className</code>) dynamiques
peut sembler une technique un peu folle mais ce n&#8217;est pas si terrible en
réalité. L&#8217;idée est simplement d&#8217;ajouter ou de retirer une classe CSS sur un
élément en fonction d&#8217;une propriété qui peut être <code>true</code> ou <code>false</code>. La classe
CSS contient bien sûr une transition CSS.</p>

<p>Mettons que nous avons une <code>div</code> cachée dans le DOM. Lorsque cette <code>div</code> a la
classe <code>opened</code>, elle s&#8217;affiche en glissant. Lorsqu&#8217;elle a la classe <code>closed</code>,
elle glisse de nouveau pour se cacher. Un panneau latéral est l&#8217;exemple parfait,
nous allons donc en écrire un.</p>

<p>Voici un JS Bin pour que vous puissiez tester le code :</p>

<p><a class="jsbin-embed" href="http://emberjs.jsbin.com/utimiZI/88/embed?js,output">Panneaux latérales réutilisables avec Ember.js - Smashing</a></p>

<p>Voici le détail de chaque onglet :</p>

<ul>
<li><strong>JavaScript</strong><br />
Nous commençons par déclarer notre <code>SidePanelComponent</code> avec des <code>classNames</code>
par défaut. Nous utilisons ensuite <code>classNameBindings</code> pour déterminer si
<code>isOpen</code> est à <code>true</code> ou <code>false</code> de façon à retourner <code>opened</code> ou <code>closed</code> en
fonction. Notre <code>component</code> a une action <code>toggleSidepanel</code> qui passe <code>isOpen</code>
à <code>true</code> ou <code>false</code>.</li>
<li><strong>HTML</strong><br />
Les balises du panneau latéral. Vous remarquerez le bloc
<code>{{#side-panel}}…{{/side-panel}}</code>, nous pouvons placer n&#8217;importe quoi dedans
ce qui rend notre panneau latéral extrêmement puissant et réutilisable. Le
bouton <code>btn-toggle</code> appelle l&#8217;action <code>toggleSidepanel</code> située dans le
composant. Le <code>{{#if isOpen}}</code> ajoute un peu de logique en vérifiant la valeur
de la propriété <code>isOpen</code>.</li>
<li><strong>CSS</strong><br />
Ici le but principal est de masquer le panneau latéral. La classe <code>opened</code>
le fait glisser en position ouverte et la classe <code>closed</code> le fait glisser dans
l&#8217;autre sens. L&#8217;animation est rendue possible parce que nous utilisons
<code>translate2D</code> (<code>transition:transform .3s ease</code>).</li>
</ul>


<p>Les guides contiennent de nombreux exemples sur comment lier des classes
<a href="http://emberjs.com/guides/components/customizing-a-components-element">dans les composants</a> ou
<a href="http://emberjs.com/guides/templates/binding-element-class-names">dans les <em lang="en">templates</em></a>.</p>

<h3 id="modals-avec-layout-et-remontee-devenements"><em lang="en">Modals</em> avec <em lang="en">layout</em> et remontée d&#8217;événements</h3>

<p>Cette technique est bien plus compliquée que la précédente. Elle implique bien
plus de fonctionnalités d&#8217;<em lang="en">Ember.js</em>. L&#8217;idée est de faire remonter un
événement d&#8217;une vue jusqu&#8217;à la route pour changer une propriété située dans un
contrôleur quelque part dans l&#8217;application. Nous allons utiliser une <code>View</code>
plutôt qu&#8217;un <code>Component</code> (pour mémoire, un composant est simplement une vue
isolée).</p>

<p><a class="jsbin-embed" href="http://emberjs.jsbin.com/aKUWUF/55/embed?js,output">Modals réutilisables avec Ember.js - Smashing</a></p>

<ul>
<li><strong>JavaScript</strong><br />
<code>modalView</code> est le <code>layout</code> par défaut pour toutes nos <em lang="en">modals</em>. Elle
contient deux méthodes, <code>showModal</code> et <code>hideModal</code>. La méthode <code>showModal</code> est
appelée par une <code>action</code> qui remonte, en passant par le contrôleur puis par
les routes, jusqu&#8217;à trouver l&#8217;action <code>showModal</code> correspondante. Nous avons
placé <code>showModal</code> dans la route la plus haute possible, <code>applicationRoute</code>.
Son seul but est de valuer la propriété <code>modalVisible</code> dans le contrôleur
passé en second argument de l&#8217;<code>action</code>. Et oui, créer une propriété en même
temps qu&#8217;on lui donne sa valeur est possible.</li>
<li><strong>HTML</strong><br />
Chaque <em lang="en">modal</em> a son propre <em lang="en">template</em> et nous utilisons le bloc
<code>{{#view App.ModalView}}…{{/view}}</code> pour les encapsuler dans <code>modal_layout</code>.
Les contrôleurs liés aux <em lang="en">modals</em> ne sont même pas déclarés,
<em lang="en">Ember.js</em> les a en mémoire. Notez que le <em lang="en">helper</em> <code>{{render}}</code>
accepte des arguments : le nom du <em lang="en">template</em> et le contrôleur généré pour
ce <em lang="en">template</em>. Nous appelons par exemple le <em lang="en">template</em> <code>modal01</code> et
le contrôleur <code>modal01</code> (auto-généré).</li>
<li><strong>CSS</strong><br />
Pour cet exemple, les <em lang="en">modals</em> doivent être présentes dans le DOM. Cela
peut sembler contraignant mais réduit le coût d&#8217;affichage. Sans cela,
<em lang="en">Ember.js</em> doit les injecter et les supprimer à chaque appel. Le second
avantage concerne les transitions CSS. La classe <code>shown</code> applique deux
transition : tout d&#8217;abord, la position verticale (la <em lang="en">modal</em> étant en
dehors de l&#8217;écran par défaut), puis, après un court délai, l&#8217;opacité (ce qui
<a href="https://speakerdeck.com/ariya/fluid-user-interface-with-hardware-acceleration?slide=36">réduit</a> encore le <a href="http://css-tricks.com/w3conf-ariya-hidayat-fluid-user-interface-with-hardware-acceleration">coût</a>
d&#8217;affichage durant la transition).</li>
</ul>


<p>Vous trouverez bien d&#8217;autres informations sur les
<a href="http://emberjs.com/guides/views/handling-events">événements</a>,
<a href="http://emberjs.com/guides/understanding-ember/the-view-layer/#toc_event-bubbling">la remontée d&#8217;événements</a>, les
<a href="http://emberjs.com/guides/views/adding-layouts-to-views">layouts</a> et le
<em lang="en">helper</em> <a href="http://emberjs.com/guides/templates/rendering-with-helpers/#toc_the-code-render-code-helper">{{render}}</a> dans les guides.</p>

<h2 id="quest-ce-quember-data">Qu&#8217;est-ce qu&#8217;<em lang="en">Ember-Data</em></h2>

<p><em lang="en">Ember-Data</em> est en beta au moment où j&#8217;écris ces lignes, faites donc
attention si vous décidez de l&#8217;utiliser.</p>

<p>C&#8217;est une bibliothèque qui permet de récupérer les données
stockées sur le serveur, de les retenir dans un <code>Store</code>, de les mettre à jour
dans le navigateur et enfin des les renvoyer au serveur pour sauvegarde. Le
<code>Store</code> peut être configuré avec différents <em lang="en">adapters</em> en fonction de votre
<em lang="en">back-end</em>. Voici un schéma de l&#8217;architecture d&#8217;<em lang="en">Ember-data</em>.</p>

<p><img src="/images/ember/ember-data-sketch.png" alt="ember-data-sketch" /></p>

<h3 id="le-store">Le <em lang="en">store</em></h3>

<p>Le <code>Store</code> retient les informations chargées depuis le serveur (les
enregistrements). Les routes et contrôleurs peuvent effectuer des requêtes sur
le <code>Store</code> pour récupérer des enregistrements (<em lang="en">records</em>). Lorsqu&#8217;un
enregistrement est appelé pour la première fois, le <code>Store</code> demande à
l&#8217;<em lang="en">adapter</em> de le charger au travers du réseau. Le <code>Store</code> le garde ensuite
en <em lang="en">cache</em> pour les prochains appels.</p>

<h3 id="les-adapters">Les <em lang="en">adapters</em></h3>

<p>L&#8217;application effectue des requêtes sur le <code>Store</code> et l&#8217;<em lang="en">adapter</em> effectue
des requêtes sur le <em lang="en">back-end</em>. Chaque <em lang="en">adapter</em> est fait pour un
<em lang="en">back-end</em> particulier. On trouve par exemple le <code>RESTAdapter</code> qui permet
de communiquer avec un API JSON et le <code>LSAdapter</code> qui permet d&#8217;utiliser le
<em lang="en">local storage</em> du navigateur.</p>

<p>L&#8217;idée derrière <em lang="en">Ember-Data</em> est de pouvoir changer de <em lang="en">back-end</em> en
changeant simplement l&#8217;<em lang="en">adapter</em> sans changer le code de votre application.</p>

<ul>
<li><em lang="en">FixtureAdapter</em><br />
Le <code>FixtureAdapter</code> est parfait pour tester <em lang="en">Ember</em> et <em lang="en">Ember-Data</em>.
Les <em lang="en">fixtures</em> sont des données d&#8217;exemple avec lesquelles vous pouvez
travailler jusqu&#8217;à ce que votre application soit prête pour la production.
Nous avons vu <a href="#creer-notre-modele-avec-le-fixtureadapter-de-ember-data">plus tôt dans cet article</a> comment le
configurer.</li>
<li><p><em lang="en">RESTAdapter</em><br />
Le <code>RESTAdapter</code> est l&#8217;<em lang="en">adapter</em> par défaut dans <em lang="en">Ember-Data</em>. Il
permet d&#8217;effectuer des requêtes <code>GET</code>, <code>PUT</code>, <code>POST</code> et <code>DELETE</code> sur une API
REST. Il repose sur un certain nombre de
<a href="http://emberjs.com/guides/models/the-rest-adapter/#toc_json-conventions">conventions JSON spécifiques</a>. Utiliser cet <em lang="en">adapter</em>
se fait comme ceci :</p>

<p><code>App.ApplicationAdapter = DS.RESTAdapter.extend({
  host: 'https://your.api.com'
});</code><br /></p>

<p>Il y a bien plus à découvrir sur le <code>RESTAdapter</code>
<a href="http://emberjs.com/guides/models/the-rest-adapter">dans les guides</a>.</p></li>
<li><p><em lang="en">Adapter</em> personnalisé<br />
Vous pouvez utiliser un autre <em lang="en">adapter</em> que les deux par défaut
(<code>FixtureAdapter</code> et <code>RESTAdapter</code>). On en trouve bon nombre
<a href="https://github.com/search?q=ember+adapter&amp;amp;ref=reposearch">sur Github</a>.
Il y a, par exemple, l&#8217;<a href="https://github.com/rpflorence/ember-localstorage-adapter"><em lang="en">adapter</em> LocalStorage</a> dont on
peut trouver une démo dans la
<a href="http://emberjs.com/guides/getting-started/using-other-adapters"><em lang="en">Todo</em></a>
d&#8217;exemple des guides. Je l&#8217;utilise également dans la <a href="http://jkneb.github.io/ember-crud">démo</a>.</p></li>
</ul>


<h3 id="sans-utiliser-ember-data">Sans utiliser <em lang="en">Ember-Data</em></h3>

<p>Dans cet article, j&#8217;ai choisi de parler d&#8217;<em lang="en">Ember-Data</em> parce qu&#8217;il est
presque prêt et que c&#8217;est un des trucs les plus cool qui ont lieu dans le monde
JavaScript en ce moment. Vous vous demandez peut être s&#8217;il est possible de s&#8217;en
passer. La réponse est oui ! En fait, utiliser <em lang="en">Ember.js</em> sans
<em lang="en">Ember-Data</em> est assez facile.</p>

<p>Il y a deux façons de le faire.</p>

<p>Vous pouvez utiliser d&#8217;autres bibliothèques pour prendre en charge la
récupération et la persistance de vos modèles.
<a href="https://github.com/ebryn/ember-model">Ember-Model</a>,
<a href="https://github.com/zendesk/ember-resource">Ember-Resource</a>,
<a href="https://github.com/endlessinc/ember-restless">Ember-Restless</a> et, plus
récemment, <a href="http://epf.io/">EPF</a> sont de bonnes alternatives. <em lang="en">EmberWatch</em>
a rédigé un petit articles qui liste les
&ldquo;<a href="http://blog.emberwatch.com/2013/06/19/alternatives-ember-data.html">Alternatives à <em lang="en">Ember-Data</em></a>&rdquo;.</p>

<p>Une autre façon de faire pourrait être de ne pas utiliser de bibliothèque. Dans
ce cas, vous devez implémenter les méthodes de récupération des modèles via
requêtes AJAX. &ldquo;<a href="http://eviltrout.com/2013/03/23/ember-without-data.html"><em lang="en">Ember Without Ember-Data</em></a>&rdquo;, par Robin Ward
(le mec derrière <a href="http://www.discourse.org/">Discourse</a>), est une lecture
intéressante. &ldquo;<a href="http://net.tutsplus.com/tutorials/javascript-ajax/getting-into-ember-js-part-3"><em lang="en">Getting Into Ember.js, Part 3</em></a>&rdquo;, par Rey
Bango sur Nettuts+ traite en particulier des modèles.</p>

<p>Voici par exemple comment définir une méthode statique sur un modèle en
utilisant <code>reopenClass</code> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /models/user.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="c1">// our own findStuff method inside the User model</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">reopenClass</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">findStuff</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="c1">// utilise une requête AJAX / Promises classique</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s2">&quot;http://your.api.com/api&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>      <span class="c1">// crée de nouveaux Ember Objects et les stocke dans le tableau users</span>
</span><span class='line'>      <span class="nx">response</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">App</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>      <span class="c1">// retourne le tableau plein d&#39;Ember Objects</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">users</span><span class="p">;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Vous pouvez ensuite utiliser la méthode <code>findStuff</code> dans le <em lang="en">hook</em> <code>model</code>
de nos routes :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="cm">/* /routes/usersRoute.js</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">UsersRoute</span> <span class="o">=</span> <span class="nx">Em</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">model</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">App</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">findStuff</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<h2 id="quest-ce-que-la-precompilation-de-templates-handlebars">Qu&#8217;est-ce que la précompilation de <em lang="en">templates</em> <em lang="en">Handlebars</em> ?</h2>

<p>Pour faire simple, précompiler les <em lang="en">templates</em> veut dire prendre tous les
<em lang="en">templates</em> et les transposer en chaines de caractères JavaScript puis les
stocker dans <code>Ember.TEMPLATES</code>. Cela veut également dire qu&#8217;il y a un fichier en
plus, contenant la version compilée de tous vos <em lang="en">templates</em>
<em lang="en">Handlebars</em>, à charger dans votre page.</p>

<p>Pour une application assez simple, la précompilation peut être évitée. Si vous
avez cependant trop de <em lang="en">templates</em> <code>&lt;script type="text/x-handlebars"&gt;</code> dans
votre principal fichier HTML, la précompilation vous permettra de mieux
organiser votre code.</p>

<p>De plus, précompiler vos <em lang="en">templates</em> vous permet d&#8217;utiliser la version
<em lang="en">runtime</em> de <em lang="en">Handlebars</em> qui est plus légère que la version
classique. Vous pouvez trouver les deux versions (standard et <em lang="en">runtime</em>)
sur le <a href="http://handlebarsjs.com">site de <em lang="en">Handlebars</em></a>.</p>

<h3 id="conventions-de-nommage-des-templates">Conventions de nommage des <em lang="en">templates</em></h3>

<p>Les <a href="http://emberjs.com/guides/templates/rendering-with-helpers/">partials</a> doivent commencer par un <code>_</code>. Vous devez donc
déclarer un fichier <code>_yourpartial.hbs</code> ou, si vous ne précompilez pas vos
<em lang="en">templates</em>, une balise
<code>&lt;script type="text/x-handlebars" id="_yourpartial"&gt;</code>.</p>

<p>Les <a href="http://emberjs.com/guides/templates/rendering-with-helpers/">composants</a>
doivent commencer par <code>components/</code>. Vous devez donc les stocker dans un dossier
<code>components/</code> ou, si vous ne précompilez pas vos <em lang="en">templates</em>, une
balise <code>&lt;script type="text/x-handlebars" id="components/votre-composant"&gt;</code>. Vous
devez utiliser un tiret comme séparateur dans le nom des composants.</p>

<p>Vous pouvez cependant utiliser une propriété <code>templateName</code> dans les vues pour
spécifier quel <em lang="en">template</em> associer avec une vue. Voici une déclaration de
<em lang="en">template</em> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/x-handlebars&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;folder/some-template&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="nx">Un</span> <span class="nx">template</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></div></figure>


<p>Que vous pouvez associer à une vue particulière :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="nx">App</span><span class="p">.</span><span class="nx">SomeView</span> <span class="o">=</span> <span class="nx">Em</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">templateName</span><span class="o">:</span> <span class="s1">&#39;folder/some-template&#39;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<h3 id="precompiler-avec-grunt">Précompiler avec <em lang="en">Grunt</em></h3>

<p>Si vous utilisez <a href="http://gruntjs.com">Grunt</a>, vous vous en servez probablement pour d&#8217;autres
tâches liées à la construction (concatenation, compression, ce genre de choses).
Dans ce cas, vous devez connaitre le fichier <code>package.json</code> qui vient avec
<em lang="en">Node.js</em> et les modules <em lang="en">Node</em>. Je vais considérer que vous
connaissez déjà Grunt.</p>

<p>Au moment où j&#8217;écris ceci, deux <em lang="en">plugins</em> Grunt sont disponibles pour
transposer vos fichiers <code>.hbs</code> en fichier <code>templates.js</code> :
<a href="https://github.com/yaymukund/grunt-ember-handlebars">grunt-ember-handlebars</a> et
<a href="https://github.com/dgeb/grunt-ember-templates">grunt-ember-templates</a>. Le
deuxième semble un peu plus à jour que le premier.</p>

<p>J&#8217;ai écris un <em lang="en">Gist</em> pour chacun d&#8217;eux, pour vous aider avec la
configuration :</p>

<ul>
<li><a href="https://gist.github.com/jkneb/6072299">Voir le <em lang="en">Gist</em> pour <em lang="en">grunt-ember-handlebars</em></a> ;</li>
<li><a href="https://gist.github.com/jkneb/6599001">Voir le <em lang="en">Gist</em> pour <em lang="en">grunt-ember-templates</em></a>.</li>
</ul>


<p>Une fois configurés, vous devriez être à même de lancer <code>grunt</code> en ligne de
commande et cela devrait produire le fichier <code>templates.js</code>. Chargez-le dans
<code>index.html</code> (après <code>ember.js</code>) puis rendez-vous dans la console du navigateur
et tapez <code>Em.TEMPLATES</code>. Vous devriez voir un <em lang="en">hash</em> contenant tous les
<em lang="en">templates</em> compilés.</p>

<p>Notez qu&#8217;<em lang="en">Ember.js</em> n&#8217;a pas besoin du chemin complet vers un
<em lang="en">template</em> ni l&#8217;extension du fichier. En d&#8217;autres termes, le nom du
<em lang="en">template</em> devrait être <code>users/create</code> et non
<code>/assets/js/templates/users/create.hbs</code>.</p>

<p>Les deux <em lang="en">plugins</em> fournissent des options pour gérer cela. Référez-vous
aux guides respectifs ou jetez un oeil aux <em lang="en">Gists</em> ci-dessus. Vous devriez
obtenir quelque chose dans ce genre :</p>

<p><img src="/images/ember/console-templates.png" alt="console-templates" /></p>

<p>Exactement ce qu&#8217;il nous faut pour que tout marche correctement. C&#8217;est tout ce
dont vous avez besoin pour précompiler avec <em lang="en">Grunt</em>.</p>

<h3 id="precompiler-avec-rails">Précompiler avec <em lang="en">Rails</em></h3>

<p>Précompiler avec <em lang="en">Rails</em> est la façon la plus simple de faire. La
<a href="https://github.com/emberjs/ember-rails"><em lang="en">gem</em> Ember-Rails</a> se charge d&#8217;à
peu près tout. Il fonctionne <em>presque</em> <em lang="en">out-of-the-box</em>. Suivez
attentivement les instructions d&#8217;installation du <code>readme</code> sur GitHub et tout
devrait bien se passer. Selon moi, <em lang="en">Rails</em> a la meilleure intégration
<em lang="en">Ember</em>/<em lang="en">Handlebars</em> pour le moment.</p>

<h2 id="outils-astuces-et-ressources">Outils, astuces et ressources</h2>

<h3 id="lextension-chrome-ember">L&#8217;Extension Chrome <em lang="en">Ember</em></h3>

<p>L&#8217;<a href="https://chrome.google.com/webstore/detail/ember-inspector/bmdblncegkenkacieihfhpjfppoconhi">Extension <em lang="en">Ember</em></a> pour Chrome est très pratique. Une
fois installée, un onglet &ldquo;<em lang="en">Ember</em>&rdquo; apparait près de l&#8217;onglet &ldquo;Console&rdquo;.
Vous pouvez ensuite naviguer à travers vos contrôleurs, routes et vues. L&#8217;onglet
&ldquo;<em lang="en">Data</em>&rdquo; vous permettra d&#8217;explorer vos enregistrements très simplement si
vous utilisez <em lang="en">Ember-Data</em>.</p>

<p><a href="/images/ember/console-ember-extension1.png"><img src="/images/ember/console-ember-extension1-300x156.png" alt="console-ember-extension" /></a><br />
<em>Exploring your app’s objects has never been so easy.</em></p>

<h3 id="ember-app-kit"><em lang="en">Ember App Kit</em></h3>

<p>Le <a href="http://iamstef.net/ember-app-kit/">Ember App Kit</a>, maintenu par l&#8217;équipe
<em lang="en">Ember</em>, vous permet de créer très rapidement une application <em lang="en">Ember</em>.
Il contient <a href="http://gruntjs.com">Grunt</a> pour compiler les <em lang="en">assets</em>, le lanceur de tests
<a href="http://karma-runner.github.io/0.10/index.html">Kharma</a>,
<a href="http://bower.io/">Bower</a> et le support des
<a href="http://wiki.ecmascript.org/doku.php?id=harmony:modules">modules ES6</a>.</p>

<h3 id="ember-tools"><em lang="en">Ember Tools</em></h3>

<p>Le projet <em lang="en">GitHub</em> <a href="https://github.com/rpflorence/ember-tools">Ember Tools</a>
est un outils en ligne de commande pour créer des applications <em lang="en">Ember</em>.
Prenez une minute pour regarder le <em lang="en">GIF</em> animé dans le <code>readme</code> et vous
comprendrez pourquoi c&#8217;est si cool.</p>

<h3 id="developpement-et-version-minifie">Développement et version minifié</h3>

<p>Utilisez toujours le <em lang="en">development build</em> durant le développement, il
contient beaucoup de commentaires, de tests unitaires et un tas de messages
d&#8217;erreur utiles qui ont été supprimés dans la version minifié. Vous trouverez un
lien vers chaque version sur le <a href="http://emberjs.com/builds">site d&#8217;<em lang="en">Ember.js</em></a>.</p>

<h3 id="astuces-pour-le-debug">Astuces pour le <em lang="en">debug</em></h3>

<p><em lang="en">Ember.js</em> fournit généralement des erreur humainement lisibles dans la
console du navigateur (si vous utilisez bien la version de développement). Il
peut être cependant difficile de deviner d&#8217;où vient l&#8217;erreur. Quelques méthodes
bien pratiques sont <code>{{log something}}</code> et <code>{{controller}}</code> qui affiche le
<code>controller</code> courant pour le <em lang="en">template</em> dans lequel nous appelons le
<em lang="en">helper</em>.</p>

<p>Ou vous pouvez afficher chaque transition du <code>Router</code> comme ceci :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><pre><code class='javascript'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">App</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">LOG_TRANSITIONS</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></div></figure>


<p>Les guides contiennet une
<a href="http://emberjs.com/guides/understanding-ember/debugging">liste exhaustive</a> de
ces petites methodes bien pratiques.</p>

<h3 id="commenter-correctement-dans-handlebars">Commenter correctement dans <em lang="en">Handlebars</em></h3>

<p>Celui-là peut être frustrant. Ne commentez <strong>jamais</strong> une balise
<em lang="en">Handlebars</em> avec un commentaire HTML classique. Si vous le faites, vous
risquez de complètement casser l&#8217;application sans même savoir pourquoi.</p>

<pre><code>// ne faites jamais ça
&lt;!-- {{foo}} --&gt;

// faites plutôt ça
{{!foo}}
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>J&#8217;espère que ce long article vous a permis de mieux comprendre cet excellent
<em lang="en">framework</em>. Mais pour tout vous dire, on a à peine vu la partie émergée de
l&#8217;iceberg. Il y a tellement plus à voir. Il y a par exemple le <code>Router</code> et sa
nature asynchrone qui permet de gérer les modèles avec des <em lang="en">promises</em> (ce
qui permet de créer très facilement un <em lang="en">spinner</em> de chargement). Il y a
également le modèle objet, avec son héritage de classes ou d&#8217;instances, ou
encore les <em lang="en">mixins</em>, <em lang="en">observers</em>, filtres, macros, <code>collectionViews</code>
et composants, ou encore la gestion de dépendances entre contrôleurs et le
paquet pour les tests. Et bien plus encore !</p>

<p>Je ne pouvais bien sûr pas vous parler de tout ça. Heureusement, les guides
vous aideront sur tous ces sujets.</p>

<p><em lang="en">Happy Ember.js coding, folks!</em></p>

<h3 id="ressources">Ressources</h3>

<ul>
<li><a href="http://emberjs.com/guides/">Guides <em lang="en">Ember.js</em></a><br />
Le meilleur endroit pour apprendre <em lang="en">Ember.js</em></li>
<li><a href="http://emberjs.com/guides/cookbook/">Ember.js Cookbook</a><br />
Une nouvelle section des guides qui résout plein de problèmes spécifiques</li>
<li><a href="http://emberwatch.com"><em lang="en">EmberWatch</em></a><br />
Agrégation de toutes les ressources importantes</li>
<li><a href="http://emberweekly.com/issues.html"><em lang="en">Ember Weekly</em></a><br />
Parfait pour rester à jour</li>
<li><a href="http://discuss.emberjs.com">Forum de discussion <em lang="en">Ember.js</em></a><br />
C&#8217;est ici que les discussions prennent place (et c&#8217;est fait avec <em lang="en">Ember</em>)</li>
</ul>


<h3 id="remerciements">Remerciements</h3>

<p>Un immense merci à <a href="https://twitter.com/MatBreton">Mathieu Breton</a> et
<a href="https://twitter.com/ficastelli">Philippe Castelli</a> qui m&#8217;ont tous deux transmis
tout ce qu&#8217;ils savaient sur <em lang="en">Ember.js</em> durant mon apprentissage. Et un
grand merci à <a href="https://twitter.com/tomdale">Tom Dale</a>, qui m&#8217;a aidé à la
relecture de ce bien long article.</p>

<script src="http://static.jsbin.com/js/embed.js"></script>



</div>

        <footer>
          <p class="meta">
            
  

<span class="byline author vcard">Posted by <span class="fn">Simon Courtois (simonc)</span></span>

            








  



  

<time datetime="2014-01-16T12:00:00+01:00" pubdate data-updated="true">16/01/2014</time>
            

<span class="categories">
  
    <a class='category' href='/tags/ember/'>ember</a>, <a class='category' href='/tags/javascript/'>javascript</a>
  
</span>


          </p>
          <p class="meta">
            
              <a class="basic-alignment left" href="/article/guide-de-migration-vers-capistrano-3" title="Previous Post: Guide de migration vers Capistrano 3">&laquo; Guide de migration vers Capistrano 3</a>
            
            
              <a class="basic-alignment right" href="/article/dependency-sorting-in-ruby-with-tsort" title="Next Post: Tri de dépendances en Ruby avec TSort">Tri de dépendances en Ruby avec TSort &raquo;</a>
            
          </p>
        </footer>

        <section>
          <h1>Commentaires</h1>
          <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        </section>
      
    </div>
  </div>
</article>


        </div>

        <aside class="sidebar col-sm-3">
          <section>
  <h1>VF svp</h1>
  <p>VF svp est un projet communautaire de traduction d'articles techniques.
    Pour proposer une traduction, rendez-vous sur
    <a href="http://github.com/simonc/vfsvp.fr" title="Page Github du projet VF svp">le Github du projet</a>.</p>
</section>
<section>
  <h1>Recherche</h1>
  <form role="search" action="http://google.com/search" method="get">
    <div class="form-group">
      <input type="hidden" name="q" value="site:vfsvp.fr" />
      <input type="text" name="q" results="0" class="form-control" placeholder="Rechercher..." />
    </div>
  </form>
</section>

<section>
  <h1>Twitter</h1>
  <p><a href="https://twitter.com/VFsvp">@VFsvp</a> sur Twitter</p>
</section>

<section>
  <h1>Sponsors</h1>
  <p>
    <a href="http://www.tinci.fr"><img src="/images/sponsors/tinci.png" alt="Tinci" /></a>
  </p>
</section>

        </aside>
      </div>
    </div>

    <footer class="text-center">
      <footer role="contentinfo">
  <p>Copyright © 2014 - Simon Courtois (@simonc) -
    <span class="credit">Publié grâce à
    <a href="http://octopress.org">Octopress</a></span></p>
</footer>

    </footer>
    <script type="text/javascript">
  var disqus_shortname = 'vfsvp';

  
    var disqus_identifier = 'http://vfsvp.fr/article/une-introduction-en-profondeur-a-emberjs';
    var disqus_url = 'http://vfsvp.fr/article/une-introduction-en-profondeur-a-emberjs';
    var disqus_script = 'embed.js';
  

  (function () {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-15419839-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>

  </body>
</html>
